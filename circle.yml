machine:
  node:
    version: 0.12.7

dependencies:
  # cache_directories:
  pre:
    - sudo /opt/google-cloud-sdk/bin/gcloud -q components update
    - sudo chown -R ubuntu:ubuntu ~/.config/gcloud
    - echo $GCLOUD_AUTH_KEY | base64 --decode > ~/gcloud_auth.json
    - gcloud auth activate-service-account $GCLOUD_AUTH_EMAIL --key-file ~/gcloud_auth.json
    - gcloud config set project $GCLOUD_PROJECT_ID
  override:
    - npm install
    - npm install -g bower
    - bower install

test:
  override:
    - grunt test
  post:
    - grunt

deployment:
  master:
    branch: master
    owner: o19s
    commands:
      - gsutil rsync -R dist gs://splainer.io/
